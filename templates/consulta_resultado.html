<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consumo de {{ user_data.username }} - Hotspot Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
      body {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .resultado-container {
          max-width: 800px;
          margin: 0 auto;
          padding: 2rem;
      }
      .resultado-card {
          background: rgba(255, 255, 255, 0.95);
          border-radius: 20px;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
          padding: 2rem;
          margin-bottom: 2rem;
      }
      .user-header {
          text-align: center;
          margin-bottom: 2rem;
          padding-bottom: 1rem;
          border-bottom: 2px solid #e9ecef;
      }
      .user-header h2 {
          color: #667eea;
          margin-bottom: 0.5rem;
      }
      .speedometer-container {
          position: relative;
          width: 300px;
          height: 200px;
          margin: 2rem auto;
      }
      .speedometer {
          width: 100%;
          height: 100%;
      }
      .usage-stats {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
          margin: 2rem 0;
      }
      .stat-card {
          background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
          border-radius: 15px;
          padding: 1.5rem;
          text-align: center;
          border: 2px solid #dee2e6;
      }
      .stat-value {
          font-size: 2rem;
          font-weight: bold;
          color: #667eea;
      }
      .stat-label {
          color: #6c757d;
          font-size: 0.9rem;
          margin-top: 0.5rem;
      }
      .progress-custom {
          height: 20px;
          border-radius: 10px;
          background-color: #e9ecef;
          overflow: hidden;
          margin: 1rem 0;
      }
      .progress-bar-custom {
          height: 100%;
          background: linear-gradient(90deg, #28a745 0%, #ffc107 70%, #dc3545 100%);
          border-radius: 10px;
          transition: width 0.6s ease;
      }
      .historico-section {
          margin-top: 2rem;
      }
      .historico-item {
          background: #f8f9fa;
          border-radius: 10px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          border-left: 4px solid #667eea;
      }
      .btn-voltar {
          background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
          border: none;
          border-radius: 15px;
          padding: 0.75rem 1.5rem;
          color: white;
          text-decoration: none;
          display: inline-block;
          transition: all 0.3s ease;
      }
      .btn-voltar:hover {
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
          color: white;
      }
  </style>
</head>
<body>
  <div class="container-fluid">
      <div class="row justify-content-center">
          <div class="col-12">
              <div class="resultado-container">
                  <!-- Cabeçalho do Usuário -->
                  <div class="resultado-card">
                      <div class="user-header">
                          <h2><i class="fas fa-user-circle me-2"></i>{{ user_data.username }}</h2>
                          {% if user_data.full_name %}
                              <p class="text-muted mb-1">{{ user_data.full_name }}</p>
                          {% endif %}
                          <small class="text-muted">{{ user_data.company_name }}</small>
                      </div>

                      <!-- Velocímetro -->
                      <div class="speedometer-container">
                          <svg class="speedometer" viewBox="0 0 300 200">
                              <!-- Arco de fundo -->
                              <path d="M 50 150 A 100 100 0 0 1 250 150" 
                                    stroke="#e9ecef" 
                                    stroke-width="20" 
                                    fill="none"/>
                              
                              <!-- Arco de progresso -->
                              {% set usage_percent = (user_data.used_mb / user_data.total_mb * 100) if user_data.total_mb > 0 else 0 %}
                              {% set stroke_dasharray = 314 %}
                              {% set stroke_dashoffset = 314 - (314 * usage_percent / 100) %}
                              
                              <path d="M 50 150 A 100 100 0 0 1 250 150" 
                                    stroke="{% if usage_percent < 50 %}#28a745{% elif usage_percent < 80 %}#ffc107{% else %}#dc3545{% endif %}" 
                                    stroke-width="20" 
                                    fill="none"
                                    stroke-dasharray="{{ stroke_dasharray }}"
                                    stroke-dashoffset="{{ stroke_dashoffset }}"
                                    stroke-linecap="round"
                                    style="transition: stroke-dashoffset 1s ease;"/>
                              
                              <!-- Texto central -->
                              <text x="150" y="130" text-anchor="middle" font-size="24" font-weight="bold" fill="#667eea">
                                  {{ "%.1f"|format(usage_percent) }}%
                              </text>
                              <text x="150" y="150" text-anchor="middle" font-size="12" fill="#6c757d">
                                  Utilizado
                              </text>
                          </svg>
                      </div>

                      <!-- Barra de Progresso -->
                      <div class="progress-custom">
                          <div class="progress-bar-custom" style="width: {{ usage_percent }}%"></div>
                      </div>

                      <!-- Estatísticas -->
                      <div class="usage-stats">
                          <div class="stat-card">
                              <div class="stat-value">{{ user_data.total_mb or 0 }}</div>
                              <div class="stat-label">MB Total</div>
                          </div>
                          <div class="stat-card">
                              <div class="stat-value">{{ user_data.used_mb or 0 }}</div>
                              <div class="stat-label">MB Utilizados</div>
                          </div>
                          <div class="stat-card">
                              <div class="stat-value">{{ user_data.remaining_mb or 0 }}</div>
                              <div class="stat-label">MB Restantes</div>
                          </div>
                      </div>

                      <!-- Informações Textuais -->
                      <div class="row text-center">
                          <div class="col-md-6">
                              <h5>Consumo Atual</h5>
                              <p class="mb-1"><strong>{{ user_data.used_mb or 0 }} MB</strong> de <strong>{{ user_data.total_mb or 0 }} MB</strong></p>
                              <p class="text-muted">Restam <strong>{{ user_data.remaining_mb or 0 }} MB</strong></p>
                          </div>
                          <div class="col-md-6">
                              <h5>Última Atualização</h5>
                              <p class="mb-1">
                                  {% if user_data.updated_at %}
                                      {{ user_data.updated_at.split(' ')[0] }}
                                  {% else %}
                                      Não disponível
                                  {% endif %}
                              </p>
                              <p class="text-muted">
                                  {% if user_data.last_reset %}
                                      Último reset: {{ user_data.last_reset }}
                                  {% endif %}
                              </p>
                          </div>
                      </div>
                  </div>

                  <!-- Histórico -->
                  <div class="resultado-card">
                      <div class="historico-section">
                          <h4><i class="fas fa-history me-2"></i>Histórico dos Últimos 30 Dias</h4>
                          
                          {% if historico %}
                              <div class="mt-3">
                                  {% for item in historico %}
                                      <div class="historico-item">
                                          <div class="d-flex justify-content-between align-items-center">
                                              <div>
                                                  <strong>{{ item.data }}</strong>
                                                  <small class="text-muted ms-2">{{ item.acao }}</small>
                                              </div>
                                              <small class="text-muted">
                                                  {{ item.created_at.split(' ')[1].split('.')[0] if item.created_at else '' }}
                                              </small>
                                          </div>
                                      </div>
                                  {% endfor %}
                              </div>
                          {% else %}
                              <div class="text-center text-muted mt-3">
                                  <i class="fas fa-info-circle fa-2x mb-2"></i>
                                  <p>Nenhum histórico disponível nos últimos 30 dias</p>
                              </div>
                          {% endif %}
                      </div>
                  </div>

                  <!-- Botão Voltar -->
                  <div class="text-center">
                      <a href="{{ url_for('consulta_publica') }}" class="btn-voltar">
                          <i class="fas fa-arrow-left me-2"></i>
                          Nova Consulta
                      </a>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

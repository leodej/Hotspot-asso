{% extends "base.html" %}

{% block title %}Meus Créditos - MikroTik Manager{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0 text-gray-800">
                    <i class="fas fa-user-circle"></i> Meus Créditos
                </h1>
                <div class="text-muted">
                    <i class="fas fa-sync-alt"></i> Atualização automática a cada 30s
                </div>
            </div>

            <!-- Informações do Usuário -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        Informações da Conta
                                    </div>
                                    <div class="mb-2">
                                        <strong>Usuário:</strong> {{ hotspot_user[0] if hotspot_user else 'N/A' }}
                                    </div>
                                    <div class="mb-2">
                                        <strong>Email:</strong> {{ hotspot_user[1] if hotspot_user else 'N/A' }}
                                    </div>
                                    <div class="mb-2">
                                        <strong>Empresa:</strong> {{ hotspot_user[2] if hotspot_user else 'N/A' }}
                                    </div>
                                    <div>
                                        <strong>Perfil:</strong> {{ hotspot_user[3] if hotspot_user else 'Padrão' }}
                                        {% if hotspot_user and hotspot_user[4] %}
                                        <span class="badge badge-info ml-2">{{ hotspot_user[4] }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-user fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card border-left-success shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        Status da Conexão
                                    </div>
                                    <div class="mb-2">
                                        <span class="badge badge-success">
                                            <i class="fas fa-wifi"></i> Conectado
                                        </span>
                                    </div>
                                    <div class="mb-2">
                                        <strong>Último Reset:</strong> 
                                        {{ last_reset.strftime('%d/%m/%Y %H:%M') if last_reset else 'Nunca' }}
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-wifi fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Créditos Principais -->
            <div class="row mb-4">
                <div class="col-lg-8">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="fas fa-chart-pie"></i> Uso de Créditos
                            </h6>
                        </div>
                        <div class="card-body text-center">
                            <div class="row">
                                <div class="col-md-6">
                                    <!-- Círculo de Progresso -->
                                    <div class="progress-circle mx-auto mb-3" style="width: 200px; height: 200px; position: relative;">
                                        <svg width="200" height="200" style="transform: rotate(-90deg);">
                                            <circle cx="100" cy="100" r="80" fill="none" stroke="#e3e6f0" stroke-width="20"/>
                                            <circle cx="100" cy="100" r="80" fill="none" stroke="#1cc88a" stroke-width="20"
                                                    stroke-dasharray="{{ 2 * 3.14159 * 80 }}" 
                                                    stroke-dashoffset="{{ 2 * 3.14159 * 80 * (1 - usage_percentage / 100) }}"
                                                    stroke-linecap="round"/>
                                        </svg>
                                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                            <div class="h4 mb-0 font-weight-bold text-gray-800">{{ "%.1f"|format(usage_percentage) }}%</div>
                                            <div class="text-muted">Usado</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-left">
                                        <div class="mb-3">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                Total de Créditos
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                {{ total_credits_display }}
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Créditos Restantes
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-success">
                                                {{ remaining_credits_display }}
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                Créditos Usados
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-warning">
                                                {{ used_credits_display }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="fas fa-history"></i> Histórico (7 dias)
                            </h6>
                        </div>
                        <div class="card-body">
                            {% if usage_history %}
                                {% for day in usage_history %}
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <div class="text-sm">{{ day[0] }}</div>
                                    <div class="text-sm font-weight-bold">
                                        {% if day[1] >= 1024 %}
                                            {{ "%.2f"|format(day[1] / 1024) }} GB
                                        {% else %}
                                            {{ day[1] }} MB
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="text-center text-muted">
                                    <i class="fas fa-chart-line fa-2x mb-2"></i>
                                    <p>Nenhum histórico disponível</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alertas -->
            {% if usage_percentage > 90 %}
            <div class="alert alert-danger" role="alert">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Atenção!</strong> Você já usou {{ "%.1f"|format(usage_percentage) }}% dos seus créditos.
            </div>
            {% elif usage_percentage > 75 %}
            <div class="alert alert-warning" role="alert">
                <i class="fas fa-exclamation-circle"></i>
                <strong>Aviso:</strong> Você já usou {{ "%.1f"|format(usage_percentage) }}% dos seus créditos.
            </div>
            {% endif %}

            <!-- Botão de Logout -->
            <div class="text-center mt-4">
                <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-refresh a cada 30 segundos
setTimeout(function() {
    location.reload();
}, 30000);
</script>
{% endblock %}
